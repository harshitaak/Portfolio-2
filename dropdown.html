<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Cool Dropdown</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  <link href="assets/css/dropdown.css" rel="stylesheet">
</head>
<body>
  <div class="demo-wrap">
    <div class="dropdown" data-dropdown>
      <button class="btn dd-trigger" aria-haspopup="menu" aria-expanded="false" data-trigger>
        Actions
        <svg class="chev" width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M7 10l5 5 5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </button>
      <div class="dd-menu" role="menu" data-menu>
        <button class="dd-item" role="menuitem">New file</button>
        <button class="dd-item" role="menuitem">Duplicate</button>
        <button class="dd-item" role="menuitem">Share</button>
        <div class="dd-sep" role="separator"></div>
        <button class="dd-item danger" role="menuitem">Delete</button>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const dropdown = document.querySelector('[data-dropdown]');
      const trigger = dropdown?.querySelector('[data-trigger]');
      const menu = dropdown?.querySelector('[data-menu]');
      if(!dropdown || !trigger || !menu) return;

      function open(){
        dropdown.setAttribute('data-open','');
        trigger.setAttribute('aria-expanded','true');
        // focus first item
        const first = menu.querySelector('.dd-item');
        first && first.focus({preventScroll:true});
        document.addEventListener('pointerdown', onDocClick, {once:false});
        document.addEventListener('keydown', onKey);
      }
      function close(){
        dropdown.removeAttribute('data-open');
        trigger.setAttribute('aria-expanded','false');
        document.removeEventListener('pointerdown', onDocClick);
        document.removeEventListener('keydown', onKey);
      }
      function toggle(){ dropdown.hasAttribute('data-open') ? close() : open(); }

      function onDocClick(e){
        if(!dropdown.contains(e.target)) close();
      }
      function onKey(e){
        const items = Array.from(menu.querySelectorAll('.dd-item'));
        const idx = items.indexOf(document.activeElement);
        if(e.key==='Escape'){ close(); trigger.focus(); }
        else if(e.key==='ArrowDown'){ e.preventDefault(); (items[idx+1]||items[0])?.focus(); }
        else if(e.key==='ArrowUp'){ e.preventDefault(); (items[idx-1]||items[items.length-1])?.focus(); }
        else if(e.key==='Tab'){ close(); }
        else if(e.key==='Enter' || e.key===' '){ if(document.activeElement.classList.contains('dd-item')) { close(); trigger.focus(); } }
      }

      trigger.addEventListener('click', toggle);
      trigger.addEventListener('keydown', (e)=>{ if(e.key==='ArrowDown'){ e.preventDefault(); open(); }});
    })();
  </script>
</body>
</html>



